<!DOCTYPE html>
<html>
<head>
  <title>AgLab Camera Dashboard</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    .container {
      display: flex;
      gap: 20px;
    }
    .left-panel {
      flex: 0 0 35%;
    }
    .right-panel {
      flex: 1;
      overflow-x: auto;
    }
    img {
      width: 100%;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #444;
      padding: 6px 10px;
      text-align: left;
    }
    th {
      background-color: #eee;
    }
    h1, h2 {
      margin-bottom: 10px;
    }
    a.button {
      display: inline-block;
      padding: 8px 12px;
      background-color: #444;
      color: white;
      text-decoration: none;
      border-radius: 4px;
    }
    a.button:hover {
      background-color: #222;
    }
  </style>
</head>
<body>
  <h1>AgLab Camera Dashboard</h1>

  <p>
    <a class="button" href="{{ url_for('toggle_capture') }}">
      {% if capturing %}ðŸ›‘ Stop Capturing{% else %}ðŸ”´ Start Capturing{% endif %}
    </a>
  </p>

  <div class="container">
    <!-- LEFT PANEL -->
    <div class="left-panel">
      <h2>Latest Image</h2>
      <div id="latest-section">
        <p>No image captured yet.</p>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="right-panel">
      <h2>All Captured Image Stats</h2>
      <table id="all-stats-table">
        <tr>
          <th>Image</th><th>Dimensions</th><th>Channels</th>
          <th>Ch0 Min</th><th>Ch0 Max</th><th>Ch0 Mean</th>
          <th>Ch1 Min</th><th>Ch1 Max</th><th>Ch1 Mean</th>
          <th>Ch2 Min</th><th>Ch2 Max</th><th>Ch2 Mean</th>
        </tr>
      </table>
    </div>
  </div>

  <script>
    function updateDashboard() {
      fetch('/latest')
        .then(res => res.json())
        .then(data => {
          if (data.image && data.info) {
            const imgHTML = `<img src="/images/${data.image}?v=${Date.now()}">`;
            let infoTable = `<table>`;
            for (const [k, v] of Object.entries(data.info)) {
              infoTable += `<tr><td><b>${k}</b></td><td>${v}</td></tr>`;
            }
            infoTable += `</table>`;
            document.getElementById('latest-section').innerHTML = imgHTML + infoTable;
          }
        });

      fetch('/stats')
        .then(res => res.json())
        .then(data => {
          let rows = `
            <tr>
              <th>Image</th><th>Dimensions</th><th>Channels</th>
              <th>Ch0 Min</th><th>Ch0 Max</th><th>Ch0 Mean</th>
              <th>Ch1 Min</th><th>Ch1 Max</th><th>Ch1 Mean</th>
              <th>Ch2 Min</th><th>Ch2 Max</th><th>Ch2 Mean</th>
            </tr>`;
          for (const row of data) {
            rows += `
              <tr>
                <td>${row.image_name}</td>
                <td>${row.dimensions}</td>
                <td>${row.num_channels}</td>
                <td>${row.channel_0_min || ''}</td>
                <td>${row.channel_0_max || ''}</td>
                <td>${row.channel_0_mean || ''}</td>
                <td>${row.channel_1_min || ''}</td>
                <td>${row.channel_1_max || ''}</td>
                <td>${row.channel_1_mean || ''}</td>
                <td>${row.channel_2_min || ''}</td>
                <td>${row.channel_2_max || ''}</td>
                <td>${row.channel_2_mean || ''}</td>
              </tr>`;
          }
          document.getElementById('all-stats-table').innerHTML = rows;
        });
    }

    setInterval(updateDashboard, 5000);
  </script>
</body>
</html>
